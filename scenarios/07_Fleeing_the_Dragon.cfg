#textdomain wesnoth-War_of_the_Dragon
#SCENARIO 7: Fleeing the Dragon
#	Kazardizin has been pursuing the windsong. Lisaundra stays behind to try to delay the dragon's advance for as long as possible. You need to flee from the Dragon's army.
[scenario]
    name= _ "Fleeing the Dragon"
    id=Wotd_seventh
    turns=50
    map_data="{~add-ons/War_of_the_Dragon/maps/07_Fleeing_the_Dragon.map}"
    next_scenario=Wotd_eighth
    victory_when_enemies_defeated=no
    [music]
        name=the_king_is_dead.ogg
    [/music]

    {DUSK}
    {FIRST_WATCH}
    {SECOND_WATCH}
    {DAWN}
    {MORNING}
    {AFTERNOON}

    {WOTD_DEATHS}

#define WILD_UNIT X Y TYPE
    [unit]
        type={TYPE}
        x={X}
        y={Y}
        random_traits=yes
        ai_special=guardian
    [/unit]
#enddef
#define RWILD_UNIT X Y TYPE
    [unit]
        type={TYPE}
        side=6
        x={X}
        y={Y}
        random_traits=yes
    [/unit]
#enddef

    [side]
        side=1
        controller=human
        team_name=Alloria
        village_gold=1
        fog=yes
        shroud=yes
        color=blue
        recruit=EOM_Sky_Shard,EOM_Messenger,EOM_Light_Spirit,EOM_Crusader,EOM_Legionnaire,EOM_Wizard,EOM_Zealot
        {GOLD 200 200 200}
        type=EOM_Prophet
        id=Alloria
        [modifications]
            {TRAIT_QUICK}
            {TRAIT_INTELLIGENT}
        [/modifications]
        name= _ "Alloria"
        canrecruit=yes
        [unit]
            x,y=31,4
            id=Michael
            name= _ "Michael"
            type=EOM_Messenger
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_LOYAL}
            [/modifications]
            {IS_LOYAL}
        [/unit]
    [/side]

    [side]
        side=2
        fog=yes
        {GOLD 400 500 600}
        {INCOME 40 60 80}
        team_name=Dragon
        color=black
        village_gold=2
#ifdef HARD
        recruit=inv_Hurricane Drake,inv_Drake Blademaster,inv_Inferno Drake

#else

        recruit=inv_Hurricane Drake,inv_Drake Warrior,inv_Fire Drake

#endif

        no_leader=yes
        [ai]
            grouping=offensive
            villages_per_scout=10
            [leader_goal]
                x,y=30,5
            [/leader_goal]
            [avoid]
                x,y=36-40,22-24
            [/avoid]
        [/ai]
    [/side]
    [side]
        side=3
        fog=yes
        {GOLD 180 220 260}
        team_name=Dragon
        color=green
        village_gold=2
        recruit=Revenant,Bone Shooter,Necrophage,Wraith

        type=Death Knight
        id=tleader
        name= _ "Seth"
        canrecruit=yes
        [ai]
            villages_per_scout=30
            [avoid]
                x,y=1-13,1-13
            [/avoid]
        [/ai]
    [/side]
    [side]
        side=4
        fog=yes
        {GOLD 150 175 200}
        {INCOME 10 20 40}
        team_name=Brown
        color=red
        village_gold=2
        recruit=
        type=EOM_Garou
        id=wleader
        name= _ "Itches"
        canrecruit=yes
        [ai]
            grouping=offensive
            villages_per_scout=30
            aggression=1
        [/ai]
    [/side]
    [side]
        side=5
        fog=yes
        {GOLD 150 175 200}
        {INCOME 30 40 50}
        team_name=Alloria
        color=white
        village_gold=2
        recruit=
        type=EOM_Sicarius
        id=cleader
        name= _ "Bard"
        x,y=37,93
        canrecruit=yes
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        {WILD_UNIT 38 23 (Elvish Sylph)}
        {WILD_UNIT 15 97 (EOM_Keeper)}
        {WILD_UNIT 15 98 (EOM_Keeper)}
        {WILD_UNIT 16 96 (EOM_Keeper)}
        {WILD_UNIT 19 95 (EOM_Keeper)}
        {WILD_UNIT 20 94 (EOM_Keeper)}
        {WILD_UNIT 35 88 (EOM_Keeper)}
        {WILD_UNIT 33 89 (EOM_Keeper)}
        {WILD_UNIT 32 89 (EOM_Keeper)}
        {WILD_UNIT 30 90 (EOM_Keeper)}
        {WILD_UNIT 28 91 (EOM_Keeper)}
        {WILD_UNIT 37 89 (EOM_Keeper)}
        {WILD_UNIT 39 90 (EOM_Keeper)}
        {WILD_UNIT 26 92 (EOM_Keeper)}
        {WILD_UNIT 42 91 (EOM_Keeper)}
        {WILD_UNIT 44 92 (EOM_Keeper)}
        {WILD_UNIT 33 90 (EOM_Divine_Champion)}
        {WILD_UNIT 35 89 (EOM_Divine_Champion)}
        {WILD_UNIT 31 91 (EOM_Divine_Champion)}
        {WILD_UNIT 27 93 (EOM_Divine_Champion)}
        {WILD_UNIT 20 95 (EOM_Divine_Champion)}
        {WILD_UNIT 16 97 (EOM_Divine_Champion)}
        {WILD_UNIT 35 91 (EOM_Zealot)}
        {WILD_UNIT 41 93 (EOM_Zealot)}
        {WILD_UNIT 33 92 (EOM_Zealot)}
        {WILD_UNIT 16 100 (EOM_Zealot)}
    [/side]

    [side]
        side=6
        fog=yes
        team_name=Wild
        color=brown
        village_gold=2
        recruit=
        type=Outlaw
        id=xleader
        name= _ "Blackpaw"
        canrecruit=yes
        [ai]
            grouping=defensive
            villages_per_scout=50
        [/ai]
        {WILD_UNIT 33 83 (Giant Scorpion)}
        {WILD_UNIT 27 85 (Giant Scorpion)}
        {WILD_UNIT 5 90 (Giant Scorpion)}
        {WILD_UNIT 5 10 (EOM_Noble)}
        {WILD_UNIT 13 77 (Gryphon)}
        {WILD_UNIT 14 77 (Gryphon)}
        {WILD_UNIT 12 77 (Gryphon)}
        {WILD_UNIT 12 78 (Gryphon)}
        {WILD_UNIT 14 78 (Gryphon)}
        {WILD_UNIT 13 79 (Gryphon)}
        {WILD_UNIT 37 15 (Wose)}
        {WILD_UNIT 30 22 (Wose)}
        {WILD_UNIT 21 23 (Wose)}
        {WILD_UNIT 28 29 (Wose)}
        {WILD_UNIT 19 45 (Wose)}
        {WILD_UNIT 16 43 (Saurian Skirmisher)}
        {WILD_UNIT 14 47 (Saurian Skirmisher)}
        {WILD_UNIT 16 43 (Saurian Skirmisher)}
        {WILD_UNIT 14 54 (Saurian Skirmisher)}
        {WILD_UNIT 5 54 (Saurian Skirmisher)}
        {WILD_UNIT 34 28 (EOM_Overgrown_Devling)}
        {WILD_UNIT 35 28 (EOM_Overgrown_Devling)}
        {WILD_UNIT 38 29 (EOM_Overgrown_Devling)}
        {WILD_UNIT 34 26 (EOM_Overgrown_Devling)}
    [/side]

    [story]
        [part]
            story= _ "Chapter VI:
'Lisaundra has given her life to buy us some time. We honor her as a mighty warrior.'"
        [/part]
        [part]
            story= _ "'We move rapidly south to try to get to the Celestial Stronghold.'"
        [/part]
    [/story]

    [event]
        name=start
        [message]
            id=Alloria
            message= _ "I should not tarry long to recruit nor recall slower warriors. The Dragon will soon come with swift troops and we should try to get as far away as possible."
        [/message]
        [set_variable]
            name=Will
            value=0
        [/set_variable]
        [objectives]
            side=1
            [objective]
                description= _ "Escape the Dragon to the south"
                condition=win
            [/objective]

            [objective]
                description= _ "Death of Alloria"
                condition=lose
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=sighted
        [filter]
            type=EOM_Noble
        [/filter]
        [message]
            speaker=unit
            message= _ "Fools, you're bringing the dragon upon me!"
        [/message]
        [message]
            id=Alloria
            message= _ "I assure you that was not our intention."
        [/message]
        [message]
            speaker=unit
            message= _ "As if that matters."
        [/message]
        [message]
            race=EOM_celestial
            message= _ "I don't mean to intrude, but what are we doing stopping to speak to a vampire. We should slay him immediately. The vampires are minions of the dragon."
        [/message]
        [message]
            speaker=unit
            message= _ "I don't intend to ally myself with the dragon, thus I must slay you before he gets close enough to notice my presence."
        [/message]
        [message]
            id=Alloria
            message= _ "You haven't a chance of defeating us."
        [/message]
        [message]
            speaker=unit
            message= _ "I've a better chance against you than I do against the dragon. I can't return to the mountains for I've been exiled by Count Evenyer for not being willing to accept the inevitable and ally with the dragon."
        [/message]
        [message]
            id=Alloria
            message= _ "I'd offer to take you with us, except that I reckon that where we're going that may be a death sentence. However you could just let us pass."
        [/message]
        [message]
            speaker=unit
            message= _ "If I do then the dragon will pursue you through me. My only chance is to slay you so that he does not feel the need to come here."
        [/message]
        {RWILD_UNIT 7 7 (EOM_Fledgeling)}
        {RWILD_UNIT 11 9 (EOM_Fledgeling)}
        {RWILD_UNIT 7 7 (EOM_Fledgeling)}
        {RWILD_UNIT 4 12 (EOM_Thin_Blood)}
        {RWILD_UNIT 8 8 (EOM_Bloodborn)}
        {RWILD_UNIT 8 10 (EOM_Bloodborn)}
        {RWILD_UNIT 2 10 (EOM_Bloodborn)}
    [/event]

    [event]
        name=moveto
        [filter]
            x=15
            y=24
        [/filter]
        [message]
            speaker=unit
            message= _ "Who are you?"
        [/message]
        [unit]
            type=Silver Mage
            side=1
            x,y=15,24
            id=Will
            name= _ "Will"
            [modifications]
                {TRAIT_QUICK}
                {TRAIT_LOYAL}
            [/modifications]
            {IS_LOYAL}
        [/unit]
        [message]
            id=Will
            message= _ "Someone who can't find a safe place to research anything."
        [/message]
        [message]
            speaker=unit
            message= _ "That doesn't answer the question."
        [/message]
        [message]
            id=Will
            message= _ "My name is Will. I've been trying to research artefacts of the faerie kind. Every time I've gotten anywhere, something comes up, and in this case I'd have to be dead to not notice certain doom approaching."
        [/message]
        [message]
            speaker=unit
            message= _ "Aren't you going to try to escape?"
        [/message]
        [message]
            id=Will
            message= _ "I can use my magic to escape at any time I want, but first I mean to make a deal with the faerie who lives in the woods. However, the way is dangerous. If you can help me get there alive, I'll make it up to you later."
        [/message]
        [message]
            id=Alloria
            message= _ "Dealing with faerie is dangerous, she'd probably take you under the hill before listen to you."
        [/message]
        [message]
            id=Will
            message= _ "That is what I'm hoping."
        [/message]
    [/event]

    [event]
        name=sighted
        [filter]
            type=Elvish Sylph
        [/filter]
        [message]
            speaker=unit
            message= _ "Come to me..."
        [/message]
        [message]
            id=Alloria
            message= _ "Don't step into the mushroom ring."
        [/message]
        [message]
            id=Will
            message= _ "I know what I'm doing."
        [/message]
    [/event]

    [event]
        name=moveto
        first_time_only=no
        [filter]
            x=36,36,36,37,37,37,37,38,38,38,38,39,39,39,39,40,40,40
            y=22,23,24,22,23,24,25,21,22,24,25,22,23,24,25,22,23,24
            [not]
                id=Will
            [/not]
        [/filter]
        [terrain]
            x,y=$x1,$y1
            terrain=Xv
        [/terrain]
        [kill]
            x,y=$x1,$y1
        [/kill]
        [if]
            side_number=1
            [then]
                [message]
                    id=Alloria
                    message= _ "She took them under the hill, we'll never find them again."
                [/message]
            [/then]
        [/if]
    [/event]
    [event]
        name=moveto
        [filter]
            x=36,36,36,37,37,37,37,38,38,38,38,39,39,39,39,40,40,40
            y=22,23,24,22,23,24,25,21,22,24,25,22,23,24,25,22,23,24
            id=Will
        [/filter]
        [terrain]
            x,y=$x1,$y1
            terrain=Xv
        [/terrain]
        [kill]
            x,y=$x1,$y1
        [/kill]
        [set_variable]
            name=Will
            value=1
        [/set_variable]
        [message]
            id=Alloria
            message= _ "Looks like he got what he wanted."
        [/message]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [terrain]
            x=36,36,36,37,37,37,37,38,38,38,38,39,39,39,39,40,40,40
            y=22,23,24,22,23,24,25,21,22,24,25,22,23,24,25,22,23,24
            terrain=Ggf
        [/terrain]
    [/event]

    [event]
        name=new turn
        first_time_only=no
        [if]
            [variable]
                name=time
                equals=$turn_number
            [/variable]
            [then]
                [unit]
                    type=Dark Dragon
                    x,y=45,1
                    id=Dragon
                    side=2
                    name= _ "Kzardizin"
                    canrecruit=yes
                [/unit]
                {FORCE_CHANCE_TO_HIT side=1 id="Dragon" 0 ()}
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=45,2
                    id=minion
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=44,2
                    id=minion2
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=44,1
                    id=minion3
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=43,2
                    id=minion4
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Inferno Drake
                    side=2
                    x,y=43,3
                    id=minion5
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Inferno Drake
                    side=2
                    x,y=43,4
                    id=minion6
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Inferno Drake
                    side=2
                    x,y=43,5
                    id=minion7
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=45,3
                    id=minion8
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=45,4
                    id=minion9
                    name= _ "Unseen"
                [/unit]
                [unit]
                    type=inv_Drake Blademaster
                    side=2
                    x,y=45,5
                    id=minion10
                    name= _ "Unseen"
                [/unit]
                [message]
                    id=Alloria
                    message= _ "I can sense that the Dragon's forces are coming close."
                [/message]
                [music]
                    name=revenge.ogg
                [/music]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=7-29
            y=61-64
        [/filter]

        [unit]
            type=EOM_Devling_Chief
            side=6
            x,y=14,64
            id=Devling Chief
        [/unit]
        [unit]
            type=EOM_Lurker
            side=6
            x,y=9,62
        [/unit]
        [unit]
            type=EOM_Lurker
            side=6
            x,y=31,64
        [/unit]
        [unit]
            type=EOM_Lurker
            side=6
            x,y=16,64
        [/unit]
        [unit]
            type=EOM_Lurker
            side=6
            x,y=12,66
        [/unit]
        [unit]
            type=EOM_Overgrown_Devling
            side=6
            x,y=9,63
        [/unit]
        [unit]
            type=EOM_Devling_Soldier
            side=6
            x,y=5,65
        [/unit]
        [unit]
            type=EOM_Overgrown_Devling
            side=6
            x,y=26,63
        [/unit]
        [unit]
            type=EOM_Devling_Soldier
            side=6
            x,y=17,64
        [/unit]
        [unit]
            type=EOM_Overgrown_Devling
            side=6
            x,y=20,64
        [/unit]
        [unit]
            type=EOM_Devling_Soldier
            side=6
            x,y=18,66
        [/unit]
        [unit]
            type=EOM_Cursers
            side=6
            x,y=14,66
        [/unit]
        [unit]
            type=EOM_Cursers
            side=6
            x,y=9,67
        [/unit]
        [unit]
            type=EOM_Cursers
            side=6
            x,y=10,67
        [/unit]
        [unit]
            type=EOM_Cursers
            side=6
            x,y=27,66
        [/unit]
        [message]
            id=Devling Chief
            message= _ "Get em!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            y=61-67
        [/filter]
        [set_recruit]
            side=6
            recruit=Thug,Poacher
        [/set_recruit]
    [/event]
    [event]
        name=turn 9
        [set_recruit]
            side=4
            recruit=EOM_Shadow_Pelt,EOM_Warrior_Warg, EOM_Black_Hunter
        [/set_recruit]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Alloria
            [filter_location]
                x,y=35,93
                radius=5
            [/filter_location]
        [/filter]
        [message]
            id=cleader
            message= _ "Fortune smiles. Welcome to our city. Our ruler has been looking for your kind."
        [/message]
        [message]
            id=Alloria
            message= _ "Convenient. We wish to see your ruler. Beware, the Dragon's armies follow us, and fight under cover of the dragon's sorcery."
        [/message]
        [message]
            id=cleader
            message= _ "We will send you along to the capital as swiftly as possible. We knew the dragon was coming, and we've prepared for him. We may not be able to hold him off forever, but sorcery or not, we won't go down without an incredible fight."
        [/message]
        [if]
            [have_unit]
                id=Will
            [/have_unit]
            [then]
                [message]
                    id=Will
                    message= _ "I guess I didn't get to accomplish my objective, and I'm certainly not going back now. Farewell, I don't imagine we will see each other again. (he vanishes in a puff of smoke)"
                [/message]
                [kill]
                    id=Will
                [/kill]
            [/then]
        [/if]
        [endlevel]
            result=victory
            bonus=no
        [/endlevel]
    [/event]
    [event]
        name=sighted
        [filter]
            race=EOM_warg
        [/filter]
        [message]
            id=Alloria
            message= _ "Be careful. These warg may be of stronger stock than the ones I saw earlier, but they are just as infested."
        [/message]
    [/event]
    [event]
        name=sighted
        [filter]
            race=undead
        [/filter]
        [message]
            id=Alloria
            message= _ "The celestials are getting sloppy or overextended. These undead were in their territory even before the dragon came, and yet they did not eliminate them."
        [/message]
    [/event]
    [event]
        name=turn 20
        [set_recruit]
            side=6
            recruit=Poacher,Thug,Footpad
        [/set_recruit]
    [/event]
[/scenario]
